<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Section 56 JOIN | Data Management</title>
  <meta name="description" content="You’ll learn how to get data, get it into the most useful structure, transform it, visualize it and model it. In this course, you will find a practicum of skills for data science. You’ll learn how to clean data and draw plots—and many other things besides. These are the skills that allow data science to happen, and here you will find the best practices for doing each of these things. You’ll learn how to use the grammar of graphics, literate programming, and reproducible research to save time. You’ll also learn how to manage cognitive resources to facilitate discoveries when wrangling, visualizing and exploring data. This is a three-credit hour course." />
  <meta name="generator" content="bookdown 0.21.6 and GitBook 2.6.7" />

  <meta property="og:title" content="Section 56 JOIN | Data Management" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="You’ll learn how to get data, get it into the most useful structure, transform it, visualize it and model it. In this course, you will find a practicum of skills for data science. You’ll learn how to clean data and draw plots—and many other things besides. These are the skills that allow data science to happen, and here you will find the best practices for doing each of these things. You’ll learn how to use the grammar of graphics, literate programming, and reproducible research to save time. You’ll also learn how to manage cognitive resources to facilitate discoveries when wrangling, visualizing and exploring data. This is a three-credit hour course." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Section 56 JOIN | Data Management" />
  
  <meta name="twitter:description" content="You’ll learn how to get data, get it into the most useful structure, transform it, visualize it and model it. In this course, you will find a practicum of skills for data science. You’ll learn how to clean data and draw plots—and many other things besides. These are the skills that allow data science to happen, and here you will find the best practices for doing each of these things. You’ll learn how to use the grammar of graphics, literate programming, and reproducible research to save time. You’ll also learn how to manage cognitive resources to facilitate discoveries when wrangling, visualizing and exploring data. This is a three-credit hour course." />
  

<meta name="author" content="Markum Reed" />


<meta name="date" content="2021-01-07" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="case-statements.html"/>
<link rel="next" href="sql-basics.html"/>
<script src="libs/header-attrs-2.6.4/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

true

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Data Management</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="join-1" class="section level1" number="56">
<h1><span class="header-section-number">Section 56</span> JOIN</h1>
<div id="stitching-tables-together" class="section level2" number="56.1">
<h2><span class="header-section-number">56.1</span> Stitching Tables Together</h2>
<p>Joining is the defining functionality of SQL an dsets it apart from other data technologies.</p>
<p>Remember:</p>
<p>Normalized databases have tables with fields that point to other tables. Sonciser the CUSTOMER_ORDER table, which has a CUSTOMER_ID field.</p>
<pre><code>%%sql
SELECT * FROM customer
LIMIT 10;</code></pre>
<pre><code>   sqlite:///oreilly_getting_started_with_sql/rexon.db
 * sqlite:///oreilly_getting_started_with_sql/rexon_metals.db
   sqlite:///oreilly_getting_started_with_sql/weather_stations.db
Done.</code></pre>
<table>
<tr>
<th>
CUSTOMER_ID
</th>
<th>
NAME
</th>
<th>
REGION
</th>
<th>
STREET_ADDRESS
</th>
<th>
CITY
</th>
<th>
STATE
</th>
<th>
ZIP
</th>
</tr>
<tr>
<td>
1
</td>
<td>
LITE Industrial
</td>
<td>
Southwest
</td>
<td>
729 Ravine Way
</td>
<td>
Irving
</td>
<td>
TX
</td>
<td>
75014
</td>
</tr>
<tr>
<td>
2
</td>
<td>
Rex Tooling Inc
</td>
<td>
Southwest
</td>
<td>
6129 Collie Blvd
</td>
<td>
Dallas
</td>
<td>
TX
</td>
<td>
75201
</td>
</tr>
<tr>
<td>
3
</td>
<td>
Re-Barre Construction
</td>
<td>
Southwest
</td>
<td>
9043 Windy Dr
</td>
<td>
Irving
</td>
<td>
TX
</td>
<td>
75032
</td>
</tr>
<tr>
<td>
4
</td>
<td>
Prairie Construction
</td>
<td>
Southwest
</td>
<td>
264 Long Rd
</td>
<td>
Moore
</td>
<td>
OK
</td>
<td>
62104
</td>
</tr>
<tr>
<td>
5
</td>
<td>
Marsh Lane Metal Works
</td>
<td>
Southeast
</td>
<td>
9143 Marsh Ln
</td>
<td>
Avondale
</td>
<td>
LA
</td>
<td>
79782
</td>
</tr>
</table>
<p>This CUSTOMER_ID field gives us a <em>key</em> to loop up in the table CUSTOMER. Knowing this, it should be no surprise that the CUSTOMER table also has a CUSTOMER_ID field.</p>
<p>We can retrieve customerif information from an order from this table.</p>
<pre><code>%%sql
SELECT * FROM customer_order
LIMIT 10;</code></pre>
<pre><code>   sqlite:///oreilly_getting_started_with_sql/rexon.db
 * sqlite:///oreilly_getting_started_with_sql/rexon_metals.db
   sqlite:///oreilly_getting_started_with_sql/weather_stations.db
Done.</code></pre>
<table>
<tr>
<th>
ORDER_ID
</th>
<th>
ORDER_DATE
</th>
<th>
SHIP_DATE
</th>
<th>
CUSTOMER_ID
</th>
<th>
PRODUCT_ID
</th>
<th>
ORDER_QTY
</th>
<th>
SHIPPED
</th>
</tr>
<tr>
<td>
1
</td>
<td>
2015-05-15
</td>
<td>
2015-05-18
</td>
<td>
1
</td>
<td>
1
</td>
<td>
450
</td>
<td>
false
</td>
</tr>
<tr>
<td>
2
</td>
<td>
2015-05-18
</td>
<td>
2015-05-21
</td>
<td>
3
</td>
<td>
2
</td>
<td>
600
</td>
<td>
false
</td>
</tr>
<tr>
<td>
3
</td>
<td>
2015-05-20
</td>
<td>
2015-05-23
</td>
<td>
3
</td>
<td>
5
</td>
<td>
300
</td>
<td>
false
</td>
</tr>
<tr>
<td>
4
</td>
<td>
2015-05-18
</td>
<td>
2015-05-22
</td>
<td>
5
</td>
<td>
4
</td>
<td>
375
</td>
<td>
false
</td>
</tr>
<tr>
<td>
5
</td>
<td>
2015-05-17
</td>
<td>
2015-05-20
</td>
<td>
3
</td>
<td>
2
</td>
<td>
500
</td>
<td>
false
</td>
</tr>
</table>
<p>The other aspect to consider in a relationship is how many records in the child can be tited to a single record of the parent. Toake the CUSTOMER and CUSTOMER_ORDER tables and we see a <em>one-to-many relationship</em>, where a single customer record can line up with multiple orders.</p>
<p>One-to-many is the most common type of relationship since it acconodates most business needs.</p>
</div>
<div id="inner-join" class="section level2" number="56.2">
<h2><span class="header-section-number">56.2</span> INNER JOIN</h2>
<p>Understanding table relationships, we can consider that it might be nice to stich two tables together, so we can see CUSTOMER and CUSTOMER_ORDER information side by side. We can avoid using many lookups by using the JOIN operations.</p>
<p>The INNER JOIN allows us to merge two tables together. But if we are going to merge tables, we need to define a commonality between the two so records between the two line up.</p>
<pre><code>%%sql

SELECT ORDER_ID, 
CUSTOMER.CUSTOMER_ID, 
ORDER_DATE, 
SHIP_DATE, 
NAME, 
STREET_ADDRESS, 
CITY, 
STATE, 
ZIP, PRODUCT_ID, ORDER_QTY

FROM CUSTOMER INNER JOIN CUSTOMER_ORDER
ON CUSTOMER.CUSTOMER_ID = CUSTOMER_ORDER.CUSTOMER_ID;</code></pre>
<pre><code>   sqlite:///oreilly_getting_started_with_sql/rexon.db
 * sqlite:///oreilly_getting_started_with_sql/rexon_metals.db
   sqlite:///oreilly_getting_started_with_sql/weather_stations.db
Done.</code></pre>
<table>
<tr>
<th>
ORDER_ID
</th>
<th>
CUSTOMER_ID
</th>
<th>
ORDER_DATE
</th>
<th>
SHIP_DATE
</th>
<th>
NAME
</th>
<th>
STREET_ADDRESS
</th>
<th>
CITY
</th>
<th>
STATE
</th>
<th>
ZIP
</th>
<th>
PRODUCT_ID
</th>
<th>
ORDER_QTY
</th>
</tr>
<tr>
<td>
1
</td>
<td>
1
</td>
<td>
2015-05-15
</td>
<td>
2015-05-18
</td>
<td>
LITE Industrial
</td>
<td>
729 Ravine Way
</td>
<td>
Irving
</td>
<td>
TX
</td>
<td>
75014
</td>
<td>
1
</td>
<td>
450
</td>
</tr>
<tr>
<td>
2
</td>
<td>
3
</td>
<td>
2015-05-18
</td>
<td>
2015-05-21
</td>
<td>
Re-Barre Construction
</td>
<td>
9043 Windy Dr
</td>
<td>
Irving
</td>
<td>
TX
</td>
<td>
75032
</td>
<td>
2
</td>
<td>
600
</td>
</tr>
<tr>
<td>
3
</td>
<td>
3
</td>
<td>
2015-05-20
</td>
<td>
2015-05-23
</td>
<td>
Re-Barre Construction
</td>
<td>
9043 Windy Dr
</td>
<td>
Irving
</td>
<td>
TX
</td>
<td>
75032
</td>
<td>
5
</td>
<td>
300
</td>
</tr>
<tr>
<td>
4
</td>
<td>
5
</td>
<td>
2015-05-18
</td>
<td>
2015-05-22
</td>
<td>
Marsh Lane Metal Works
</td>
<td>
9143 Marsh Ln
</td>
<td>
Avondale
</td>
<td>
LA
</td>
<td>
79782
</td>
<td>
4
</td>
<td>
375
</td>
</tr>
<tr>
<td>
5
</td>
<td>
3
</td>
<td>
2015-05-17
</td>
<td>
2015-05-20
</td>
<td>
Re-Barre Construction
</td>
<td>
9043 Windy Dr
</td>
<td>
Irving
</td>
<td>
TX
</td>
<td>
75032
</td>
<td>
2
</td>
<td>
500
</td>
</tr>
</table>
<ol style="list-style-type: decimal">
<li><p>Select the fields we want from the CUSTOMER and CUSTOMER_ORDER tables.</p></li>
<li><p>The important part that temorarily merges two tables into one.</p></li>
</ol>
</div>
<div id="left-join" class="section level2" number="56.3">
<h2><span class="header-section-number">56.3</span> LEFT JOIN</h2>
<p>Two customers were excluded from the INNER JOIN on CUSTOMER_ID since they didn’t have any orders to join on. But suppose we wanted them included anyways.</p>
<p>Modify the previous query to utilize the LEFT JOIN:</p>
<pre><code>%%sql

SELECT ORDER_ID, 
CUSTOMER.CUSTOMER_ID, 
ORDER_DATE, 
SHIP_DATE, 
NAME, 
STREET_ADDRESS, 
CITY, 
STATE, 
ZIP, PRODUCT_ID, ORDER_QTY

FROM CUSTOMER LEFT JOIN CUSTOMER_ORDER
ON CUSTOMER.CUSTOMER_ID = CUSTOMER_ORDER.CUSTOMER_ID;</code></pre>
<pre><code>   sqlite:///oreilly_getting_started_with_sql/rexon.db
 * sqlite:///oreilly_getting_started_with_sql/rexon_metals.db
   sqlite:///oreilly_getting_started_with_sql/weather_stations.db
Done.</code></pre>
<table>
<tr>
<th>
ORDER_ID
</th>
<th>
CUSTOMER_ID
</th>
<th>
ORDER_DATE
</th>
<th>
SHIP_DATE
</th>
<th>
NAME
</th>
<th>
STREET_ADDRESS
</th>
<th>
CITY
</th>
<th>
STATE
</th>
<th>
ZIP
</th>
<th>
PRODUCT_ID
</th>
<th>
ORDER_QTY
</th>
</tr>
<tr>
<td>
1
</td>
<td>
1
</td>
<td>
2015-05-15
</td>
<td>
2015-05-18
</td>
<td>
LITE Industrial
</td>
<td>
729 Ravine Way
</td>
<td>
Irving
</td>
<td>
TX
</td>
<td>
75014
</td>
<td>
1
</td>
<td>
450
</td>
</tr>
<tr>
<td>
None
</td>
<td>
2
</td>
<td>
None
</td>
<td>
None
</td>
<td>
Rex Tooling Inc
</td>
<td>
6129 Collie Blvd
</td>
<td>
Dallas
</td>
<td>
TX
</td>
<td>
75201
</td>
<td>
None
</td>
<td>
None
</td>
</tr>
<tr>
<td>
5
</td>
<td>
3
</td>
<td>
2015-05-17
</td>
<td>
2015-05-20
</td>
<td>
Re-Barre Construction
</td>
<td>
9043 Windy Dr
</td>
<td>
Irving
</td>
<td>
TX
</td>
<td>
75032
</td>
<td>
2
</td>
<td>
500
</td>
</tr>
<tr>
<td>
2
</td>
<td>
3
</td>
<td>
2015-05-18
</td>
<td>
2015-05-21
</td>
<td>
Re-Barre Construction
</td>
<td>
9043 Windy Dr
</td>
<td>
Irving
</td>
<td>
TX
</td>
<td>
75032
</td>
<td>
2
</td>
<td>
600
</td>
</tr>
<tr>
<td>
3
</td>
<td>
3
</td>
<td>
2015-05-20
</td>
<td>
2015-05-23
</td>
<td>
Re-Barre Construction
</td>
<td>
9043 Windy Dr
</td>
<td>
Irving
</td>
<td>
TX
</td>
<td>
75032
</td>
<td>
5
</td>
<td>
300
</td>
</tr>
<tr>
<td>
None
</td>
<td>
4
</td>
<td>
None
</td>
<td>
None
</td>
<td>
Prairie Construction
</td>
<td>
264 Long Rd
</td>
<td>
Moore
</td>
<td>
OK
</td>
<td>
62104
</td>
<td>
None
</td>
<td>
None
</td>
</tr>
<tr>
<td>
4
</td>
<td>
5
</td>
<td>
2015-05-18
</td>
<td>
2015-05-22
</td>
<td>
Marsh Lane Metal Works
</td>
<td>
9143 Marsh Ln
</td>
<td>
Avondale
</td>
<td>
LA
</td>
<td>
79782
</td>
<td>
4
</td>
<td>
375
</td>
</tr>
</table>
<p>The table specifiedon the “left” side of the LEFT JOIN operator will have all its records included, even if they do not have any child records in the “right” table. Notice we have two additional records for the customers that have no orders.</p>
<p>It is common to use LEFT JOIN to find “orphaned” child records.</p>
<pre><code>%%sql

SELECT 
CUSTOMER.CUSTOMER_ID,
NAME as CUSTOMER_NAME
FROM CUSTOMER LEFT JOIN CUSTOMER_ORDER
ON CUSTOMER.CUSTOMER_ID = CUSTOMER_ORDER.CUSTOMER_ID
WHERE ORDER_ID IS NULL;</code></pre>
<pre><code>   sqlite:///oreilly_getting_started_with_sql/rexon.db
 * sqlite:///oreilly_getting_started_with_sql/rexon_metals.db
   sqlite:///oreilly_getting_started_with_sql/weather_stations.db
Done.</code></pre>
<table>
<tr>
<th>
CUSTOMER_ID
</th>
<th>
CUSTOMER_NAME
</th>
</tr>
<tr>
<td>
2
</td>
<td>
Rex Tooling Inc
</td>
</tr>
<tr>
<td>
4
</td>
<td>
Prairie Construction
</td>
</tr>
</table>
</div>
<div id="joining-mutliple-tables" class="section level2" number="56.4">
<h2><span class="header-section-number">56.4</span> Joining Mutliple Tables</h2>
<p>Relationsal databses can be complex in terms of relationships between tables.</p>
<p>For example, we can supply not only CUSTOMER information to the CUSTOMER_ORDER table, but also PRODUCT information using PRODUCT_ID.</p>
<p>We can use these relationships to execute a query that displays orders with customer information and product information simultaneously. All we do is define the two joins.</p>
<pre><code>%%sql

SELECT
ORDER_ID,
CUSTOMER.CUSTOMER_ID,
NAME as CUSTOMER_NAME,
STREET_ADDRESS,
CITY,
STATE,
ZIP,
ORDER_DATE,
PRODUCT.PRODUCT_ID,
DESCRIPTION,
ORDER_QTY,
ORDER_QTY * PRICE as REVENUE

FROM CUSTOMER
INNER JOIN CUSTOMER_ORDER 
ON CUSTOMER.CUSTOMER_ID = CUSTOMER_ORDER.CUSTOMER_ID

INNER JOIN PRODUCT
ON CUSTOMER_ORDER.PRODUCT_ID = PRODUCT.PRODUCT_ID</code></pre>
<pre><code>   sqlite:///oreilly_getting_started_with_sql/rexon.db
 * sqlite:///oreilly_getting_started_with_sql/rexon_metals.db
   sqlite:///oreilly_getting_started_with_sql/weather_stations.db
Done.</code></pre>
<table>
<tr>
<th>
ORDER_ID
</th>
<th>
CUSTOMER_ID
</th>
<th>
CUSTOMER_NAME
</th>
<th>
STREET_ADDRESS
</th>
<th>
CITY
</th>
<th>
STATE
</th>
<th>
ZIP
</th>
<th>
ORDER_DATE
</th>
<th>
PRODUCT_ID
</th>
<th>
DESCRIPTION
</th>
<th>
ORDER_QTY
</th>
<th>
REVENUE
</th>
</tr>
<tr>
<td>
1
</td>
<td>
1
</td>
<td>
LITE Industrial
</td>
<td>
729 Ravine Way
</td>
<td>
Irving
</td>
<td>
TX
</td>
<td>
75014
</td>
<td>
2015-05-15
</td>
<td>
1
</td>
<td>
Copper
</td>
<td>
450
</td>
<td>
3379.5
</td>
</tr>
<tr>
<td>
2
</td>
<td>
3
</td>
<td>
Re-Barre Construction
</td>
<td>
9043 Windy Dr
</td>
<td>
Irving
</td>
<td>
TX
</td>
<td>
75032
</td>
<td>
2015-05-18
</td>
<td>
2
</td>
<td>
Aluminum
</td>
<td>
600
</td>
<td>
1548.0
</td>
</tr>
<tr>
<td>
3
</td>
<td>
3
</td>
<td>
Re-Barre Construction
</td>
<td>
9043 Windy Dr
</td>
<td>
Irving
</td>
<td>
TX
</td>
<td>
75032
</td>
<td>
2015-05-20
</td>
<td>
5
</td>
<td>
Bronze
</td>
<td>
300
</td>
<td>
1200
</td>
</tr>
<tr>
<td>
4
</td>
<td>
5
</td>
<td>
Marsh Lane Metal Works
</td>
<td>
9143 Marsh Ln
</td>
<td>
Avondale
</td>
<td>
LA
</td>
<td>
79782
</td>
<td>
2015-05-18
</td>
<td>
4
</td>
<td>
Steel
</td>
<td>
375
</td>
<td>
4616.25
</td>
</tr>
<tr>
<td>
5
</td>
<td>
3
</td>
<td>
Re-Barre Construction
</td>
<td>
9043 Windy Dr
</td>
<td>
Irving
</td>
<td>
TX
</td>
<td>
75032
</td>
<td>
2015-05-17
</td>
<td>
2
</td>
<td>
Aluminum
</td>
<td>
500
</td>
<td>
1290.0
</td>
</tr>
</table>
</div>
<div id="grouping-joins" class="section level2" number="56.5">
<h2><span class="header-section-number">56.5</span> Grouping JOINs</h2>
<p>We have orders with their revenue, thatnks to the join we built. But suppose we want to find the total_revenue by customer? We still need to use all three tables and merge them together with out current join setup, since we need the revenue we just calculated. But also we need to do a GROUP BY:</p>
<pre><code>%%sql

SELECT CUSTOMER.CUSTOMER_ID,
NAME as CUSTOMER_NAME,
sum(ORDER_QTY * PRICE) as TOTAL_REVENUE

FROM CUSTOMER_ORDER

INNER JOIN CUSTOMER
ON CUSTOMER.CUSTOMER_ID = CUSTOMER_ORDER.CUSTOMER_ID 

INNER JOIN PRODUCT
ON CUSTOMER_ORDER.PRODUCT_ID = PRODUCT.PRODUCT_ID

GROUP BY 1, 2</code></pre>
<pre><code>   sqlite:///oreilly_getting_started_with_sql/rexon.db
 * sqlite:///oreilly_getting_started_with_sql/rexon_metals.db
   sqlite:///oreilly_getting_started_with_sql/weather_stations.db
Done.</code></pre>
<table>
<tr>
<th>
CUSTOMER_ID
</th>
<th>
CUSTOMER_NAME
</th>
<th>
TOTAL_REVENUE
</th>
</tr>
<tr>
<td>
1
</td>
<td>
LITE Industrial
</td>
<td>
3379.5
</td>
</tr>
<tr>
<td>
3
</td>
<td>
Re-Barre Construction
</td>
<td>
4038.0
</td>
</tr>
<tr>
<td>
5
</td>
<td>
Marsh Lane Metal Works
</td>
<td>
4616.25
</td>
</tr>
</table>
<p>Since we want all customers we can use LEFT JOIN in place of INNER JOIN</p>
<pre><code>%%sql

SELECT CUSTOMER.CUSTOMER_ID,
NAME as CUSTOMER_NAME,
coalesce(sum(ORDER_QTY * PRICE),0) as TOTAL_REVENUE

FROM CUSTOMER_ORDER

LEFT JOIN CUSTOMER
ON CUSTOMER.CUSTOMER_ID = CUSTOMER_ORDER.CUSTOMER_ID 

LEFT JOIN PRODUCT
ON CUSTOMER_ORDER.PRODUCT_ID = PRODUCT.PRODUCT_ID

GROUP BY 1, 2</code></pre>
<pre><code>   sqlite:///oreilly_getting_started_with_sql/rexon.db
 * sqlite:///oreilly_getting_started_with_sql/rexon_metals.db
   sqlite:///oreilly_getting_started_with_sql/weather_stations.db
Done.</code></pre>
<table>
<tr>
<th>
CUSTOMER_ID
</th>
<th>
CUSTOMER_NAME
</th>
<th>
TOTAL_REVENUE
</th>
</tr>
<tr>
<td>
1
</td>
<td>
LITE Industrial
</td>
<td>
3379.5
</td>
</tr>
<tr>
<td>
3
</td>
<td>
Re-Barre Construction
</td>
<td>
4038.0
</td>
</tr>
<tr>
<td>
5
</td>
<td>
Marsh Lane Metal Works
</td>
<td>
4616.25
</td>
</tr>
</table>
<pre><code></code></pre>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="case-statements.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="sql-basics.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["data_management.pdf", "data_management.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
